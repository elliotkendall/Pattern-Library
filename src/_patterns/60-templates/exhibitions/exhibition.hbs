{{! Format the start date for display. }}
{{#if date.start.date}}
  {{#if date.start.month}}
    {{assign 'date.start.display' (moment date.start.date 'MMMM YYYY')}}
  {{else}}
    {{assign 'date.start.display' (moment date.start.date 'MMMM D, YYYY')}}
  {{/if}}
{{else}}
  {{assign 'date.start.display' null}}
{{/if}}

{{! Format the end date for display. }}
{{#if date.end.date}}
  {{#if date.end.month}}
    {{assign 'date.end.display' (moment date.end.date 'MMMM YYYY')}}
  {{else}}
    {{assign 'date.end.display' (moment date.end.date 'MMMM D, YYYY')}}
  {{/if}}
{{else}}
  {{assign 'date.end.display' null}}
{{/if}}

{{! Format the date range for display. }}
{{#if (and date.start.date date.end.date)}}
  {{#if (momentIsSame date.start.date date.end.date)}}
    {{assign 'date.display' date.start.display}}
    {{#if (and date.start.time date.end.time)}}
      {{assign 'date.display' (combine date.display ' ' (moment date.start.time 'h:mm A') ' - ' (moment date.end.time 'h:mm A'))}}
    {{else if date.start.time}}
      {{assign 'date.display' (combine date.display ' ' (moment date.start.time 'h:mm A'))}}
    {{else if date.end.time}}
      {{assign 'date.display' (combine date.display ' Until' (moment date.end.time 'h:mm A'))}}
    {{/if}}
  {{else}}
    {{assign 'date.display' (combine date.start.display ' - ' date.end.display)}}
  {{/if}}

{{else if date.start.date}}
  {{#if (momentIsAfterToday date.start.date)}}
    {{assign 'date.display' (combine 'Opens ' date.start.display)}}
  {{else}}
    {{assign 'date.display' (combine 'Since ' date.start.display)}}
  {{/if}}
  {{#if date.start.time}}
    {{assign 'date.display' (combine date.display ' ' (moment date.start.time 'h:mm A'))}}
  {{/if}}

{{else if date.end.date}}
  {{assign 'date.display' (combine 'Through ' date.end.display)}}
  {{#if date.end.time}}
    {{assign 'date.display' (combine date.display ' ' (moment date.end.time 'h:mm A'))}}
  {{/if}}
{{else}}
  {{assign 'date.display' 'TBD'}}
{{/if}}

{{! Format events. }}
{{#if events}}

  {{! Format each event. }}
  {{#each events}}

    {{! Format the start date for display. }}
    {{#if date.start.date}}
      {{#if date.start.month}}
        {{assign 'date.start.display' (moment date.start.date 'MMMM YYYY')}}
      {{else}}
        {{assign 'date.start.display' (moment date.start.date 'MMMM D, YYYY')}}
      {{/if}}
    {{else}}
      {{assign 'date.start.display' null}}
    {{/if}}

    {{! Format the end date for display. }}
    {{#if date.end.date}}
      {{#if date.end.month}}
        {{assign 'date.end.display' (moment date.end.date 'MMMM YYYY')}}
      {{else}}
        {{assign 'date.end.display' (moment date.end.date 'MMMM D, YYYY')}}
      {{/if}}
    {{else}}
      {{assign 'date.end.display' null}}
    {{/if}}

    {{! Format the date range for display. }}
    {{#if (and date.start.date date.end.date)}}
      {{#if (momentIsSame date.start.date date.end.date)}}
        {{assign 'date.display' date.start.display}}
        {{#if (and date.start.time date.end.time)}}
          {{assign 'date.display' (combine date.display ' ' (moment date.start.time 'h:mm A') ' - ' (moment date.end.time 'h:mm A'))}}
        {{else if date.start.time}}
          {{assign 'date.display' (combine date.display ' ' (moment date.start.time 'h:mm A'))}}
        {{else if date.end.time}}
          {{assign 'date.display' (combine date.display ' Until' (moment date.end.time 'h:mm A'))}}
        {{/if}}
      {{else}}
        {{assign 'date.display' (combine date.start.display ' - ' date.end.display)}}
      {{/if}}

    {{else if date.start.date}}
      {{#if (momentIsAfterToday date.start.date)}}
        {{assign 'date.display' (combine 'Opens ' date.start.display)}}
      {{else}}
        {{assign 'date.display' (combine 'Since ' date.start.display)}}
      {{/if}}
      {{#if date.start.time}}
        {{assign 'date.display' (combine date.display ' ' (moment date.start.time 'h:mm A'))}}
      {{/if}}

    {{else if date.end.date}}
      {{assign 'date.display' (combine 'Through ' date.end.display)}}
      {{#if date.end.time}}
        {{assign 'date.display' (combine date.display ' ' (moment date.end.time 'h:mm A'))}}
      {{/if}}
    {{else}}
      {{assign 'date.display' 'TBD'}}
    {{/if}}

    {{! Save the event. }}
    {{storagePush 'events' this}}

  {{/each}}

  {{! Update events. }}
  {{assign 'events' (storageGet 'events')}}

{{/if}}

<div class="exhibition-page">
  <header class="exhibition-page-header"></header>
  <div class="exhibition-page-main">

    {{> organisms-intro-hero background-image=hero}}

    {{#extend 'organisms-main' type='exhibition-page'}}

      {{#content 'section-main-subtitle'}}
        <span class="exhibition-page-main-context">
          {{date.display}} | {{location.building}}{{#if location.room}}, {{location.room}}{{/if}}{{#if location.level}}, {{location.level}}{{/if}}
        </span>
        {{#if quote}}<p class="exhibition-page-main-quote">&ldquo;{{quote}}&rdquo;</p>{{/if}}
      {{/content}}

      {{#content 'section-main-body'}}
        {{#if markdown}}{{{markdown detail}}}{{else}}{{{detail}}}{{/if}}
      {{/content}}

      {{#content 'section-main-divider'}}
        <div class="exhibition-page-main-divider"></div>
      {{/content}}

      {{#content 'section-main-sidebar'}}

        {{! Display the image if available. }}
        {{#if image}}{{> molecules-figure}}{{/if}}

        {{! Display the date. }}
        <span class="exhibition-page-main-date">{{date.display}}</span>

        {{! Display visitor information. }}
        <div class="exhibition-page-main-sidenote">
          <h6 class="exhibition-page-main-sidenote-heading">Visitor Information</h6>
          <p class="exhibition-page-main-sidenote-content">
            The exhibition is located in the {{#if location.map}}{{> atoms-link label=location.building href=location.map icon=false}}{{else}}{{location.building}}{{/if}}{{#if location.room}}, {{location.room}},{{/if}}{{#if location.level}} on {{location.level}}{{/if}}.
          </p>
          {{> atoms-link classes="exhibition-page-main-sidenote-link" href=visitation.link.href label=visitation.link.label}}
        </div>

        {{! Display parking information. }}
        <div class="exhibition-page-main-sidenote">
          <p class="exhibition-page-main-sidenote-content">
            Parking is available in the {{parking.location}}.
          </p>
          {{> atoms-link classes="exhibition-page-main-sidenote-link" href=parking.link.href label=parking.link.label}}
        </div>

        {{! Display contact information. }}
        {{#if contact}}
          <div class="exhibition-page-main-sidenote">
            <p class="exhibition-page-main-sidenote-content">
              For more information about the exhibit...
            </p>
            {{> atoms-link classes="exhibition-page-main-sidenote-link" href=(combine 'mailto:' contact) label=contact}}
          </div>
        {{/if}}

      {{/content}}

      {{#content 'section-main-other'}}
        {{#if events}}
        {{> compounds-cards columns=(objectify s=1 m=1 l=1)
                            classes="section-main-content"
                            cards=events
                            card-type='listing'}}
        {{/if}}
      {{/content}}

    {{/extend}}

  </div>
  <footer class="exhibition-page-footer"></footer>
</div>
